\documentclass[letter]{article}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{bm}
\usepackage{ifthen}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage[hidelinks]{hyperref}
\usepackage{xcolor}
\hypersetup{
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}
}

\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

\usepackage{listings}

% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{12} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{12}  % for normal

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
language=Python,
basicstyle=\ttm,
otherkeywords={self},             % Add keywords here
keywordstyle=\ttb\color{deepblue},
emph={MyClass,__init__},          % Custom highlighting
emphstyle=\ttb\color{deepred},    % Custom highlighting style
stringstyle=\color{deepgreen},
frame=tb,                         % Any extra options here
showstringspaces=false            % 
}}


% Python environment
\lstnewenvironment{python}[1][]
{
\pythonstyle
\lstset{#1}
}
{}

% Python for external files
\newcommand\pythonexternal[2][]{{
\pythonstyle
\lstinputlisting[#1]{#2}}}

% Python for inline
\newcommand\pythoninline[1]{{\pythonstyle\lstinline!#1!}}


%%%
% Set up the margins to use a fairly large area of the page
%%%
\oddsidemargin=.2in
\evensidemargin=.2in
\textwidth=6in
\topmargin=-.5in
\textheight=9in
\parskip=.07in
\parindent=0in
\pagestyle{fancy}

%%%
% Set up the header
%%%
\newcommand{\setheader}[6]{
	\lhead{{\sc #1}\\{\sc #2} ({\small \it \today})}
	\rhead{
		{\bf #3} 
		\ifthenelse{\equal{#4}{}}{}{(#4)}\\
		{\bf #5} 
		\ifthenelse{\equal{#6}{}}{}{(#6)}%
	}
}

\makeatletter
\newcommand{\escapeus}{\begingroup\@makeother\_\@escapeus}
\newcommand*{\@escapeus}[1]{#1\endgroup}
\makeatother

%%%
% Set up some shortcut commands
%%%
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Proj}{\mathrm{proj}}
\newcommand{\Perp}{\mathrm{perp}}
\newcommand{\proj}{\mathrm{proj}}
\newcommand{\Span}{\mathrm{span}}
\newcommand{\Null}{\mathrm{null}}
\newcommand{\Rank}{\mathrm{rank}}
\newcommand{\mat}[1]{\begin{bmatrix}#1\end{bmatrix}}
\newcommand{\var}[1]{{$\langle$\it #1$\rangle$}}
\newcommand{\Code}[1]{\texttt{\escapeus #1}}
\DeclareMathOperator{\Tr}{Tr}

%%%
% This is where the body of the document goes
%%%
\begin{document}
	\setheader{MAT335}{Homework 3}{Due: 11:59pm March 15}{}{}{}

	\begin{enumerate}
		\item Consider the vector field $\vec F(x,y) = (x+y^2,-y)$ and its associated continuous dynamical system $(W^t, \R^2)$.
			\begin{enumerate}
				\item For each of the following functions, show whether or
					not it is a flow for $(W^t,\R^2)$.
					\begin{enumerate}
						\item $\vec \varphi(t) = (-e^{-2t},\sqrt{3}e^{-t})$
						\item $\vec \varphi(t) = (-e^{-4t},\sqrt{3}e^{-2t})$
						\item $\vec \varphi(t) = (\frac{4}{3}e^t-\frac{1}{3}e^{-2t},e^{-t})$
						\item $\vec \varphi(t) = (e^t-e^{-2t},e^{-t})$
					\end{enumerate}
				\item A \emph{constant flow} is a flow $\vec\varphi$ such that $\vec\varphi(t_1)=\vec \varphi(t_2)$ for
					all $t_1,t_2\in \R$.  Find all constant flows for $\vec F$. (Hint: think about $\vec\varphi\,'$ in
					this situation.)
				\item Classify all fixed points of $(W^t,\R^2)$ as stable or unstable.
				\item Find \emph{all} flows of $(W^t,\R^2)$ that pass through the point $(1,0)$.  Remember,
					if $\vec\varphi$ is a flow with this property, it is not a requirement that $\vec\varphi(0)=(1,0)$,
					only that $\vec \varphi(t_0)=(1,0)$ for some $t_0$.
				\item We call the flows $\vec\varphi_1$
					and $\vec \varphi_2$ time shifts of each other if $\vec \varphi_1(t)=\vec \varphi_2(t+t_0)$ for
					some $t_0$. Show that the flows from part (d) are time shifts of each other.  
			\end{enumerate}


		\item Let's explore the question of whether every discrete dynamical system can be
			described as the time-$1$ map of a continuous dynamical system.

			Let $(W^t,X)$ be a continuous dynamical system, and let $(T,X)$ be its time-$1$ map.
			That is, $T(x) = W^1(x)$.

			The point $x\in X$ is called \emph{periodic} for $(W^t,X)$ if there exists a $t\neq 0$ so that $W^t(x)=x$ and
			is called \emph{periodic} for $(T,X)$ if there exists an $i\neq 0$ so that $T^ix=x$. In both cases, the minimum
			$t$ or $i$ such $W^t(x)=x$ or $T^i(x)=x$ is called the \emph{period} of $x$.
			\begin{enumerate}
				\item Suppose $x\in X$ is a \emph{periodic point} for $(T,X)$. Must $x$ be a periodic point for $(W^t,X)$?
				\item Suppose $x\in X$ is a \emph{periodic point} for $(W^t,X)$. Must $x$ be a periodic point for $(T,X)$?
				\item Show that if $x$ is a point of period at least $2$ for $(T,X)$, then there are infinitely many periodic
					points for $(T,X)$ \emph{of the same period}.
				\item Consider the \emph{logistic map} $T:[0,1]\to[0,1]$ defined by $x\mapsto rx(1-x)$. Show that
					when $r=\frac{19}{6}$ the logistic map has exactly two points of period 2. (Hint: use a computer
					algebra system to solve any nasty equations you come across!)
				\item Are all discrete dynamical systems time-$1$ maps to continuous dynamical systems? Justify your answer.
			\end{enumerate}

		\item The function $G:\R^n\to\R^m$ is called \emph{affine} if there exists a matrix $A$ and
			a vector $\vec p$ so that $G(\vec x) = A\vec x+\vec p$ for all $\vec x$.

			Let $F:\R^n\to\R^m$. A \emph{first-order approximation} to $F$ at the point $\vec w\in \R^n$ is an
			affine function $L:\R^n\to\R^m$ satisfying
			\[
				\lim_{\|\vec x\|\to 0} \frac{F(\vec w+\vec x)-L(\vec w+\vec x)}{\|\vec x\|} = 0.
			\]
			\begin{enumerate}
				\item Let $F:\R\to\R$ be defined by $x\mapsto x^2$. Find a first-order approximation, $L_0$, 
					to $F$ at $0$, and a first-order approximation, $L_2$, to $F$ at $2$.
				\item Let $F:\R^2\to\R^2$ be defined by $\mat{x\\y}\mapsto \mat{a&b\\c&d}\mat{x\\y}$. Define
					$L_{\vec w}$ to be the first-order approximation of $F$ at the point $\vec w$. Find $L_{\vec w}$.
				\item Let $L$ be an affine function and let $L_{\vec w}$ be the
					first-order approximation to $L$ at $\vec w$.
					Prove that $L=L_{\vec w}$ regardless of $\vec w$.
				\item Prove that if $(W^t,\R^n)$ is a continuous dynamical system with velocities given by
					$V(\vec x)=A\vec x$ for some matrix $A$, then the point $\vec x\in \R^n$ is stable under $W^t$
					if and only if the point $\vec 0$ is stable under $W^t$.

				\item From calculus, you know that if $f:\R\to\R$ is differentiable, then $L(w+x)=f'(w)(x)+f(w)$ is a
					first-order approximation to $f$ at $w$, where $f'$ is the derivative of $f$. Use this knowledge
					to find a first-order approximation to $F(x,y) = (x+y^2,-y)$ at the points $(0,0)$ and $(1,1)$.
				\item Let $(W^t,\R^2)$ be the continuous dynamical system that flows along $F(x,y)=(x+y^2,-y)$.
					Classify $(0,0)$ and $(1,1)$ as stable or unstable. Justify your answer; in particular, if you use a
					first-order approximation, you must explain why it is an appropriate approximation to use. 
			\end{enumerate}
		\item Stability/instability describes how points behave under a dynamical system. Let's take a moment to think about
			how \emph{volumes/areas} behave.

			For this problem, you may use any facts you know about the determinant without justification (so long as they're true\ldots).

			\begin{enumerate}
				\item The \emph{trace} of a square matrix $X$, denoted $\Tr(X)$,
					is the sum of its diagonal entries. Let $A=[\vec a_1|\cdots|\vec a_n]$
					be a matrix with columns $\vec a_1,\ldots,\vec a_n$.  Let $E_i$ be the identity matrix with
					the $i$th column replaced with $\vec a_i$. Show that
					\[
						\Tr(A) = \sum \det(E_i).
					\]
				\item Let $(W^t,\R^2)$ be the continuous dynamical system which flows vectors along the vector field given
					by $A=\mat{a&b\\c&d}$.

					Write out the limit definition of the derivative $\frac{\partial W^t}{\partial t}$ at time $t=0$.
					How does this derivative relate to $A$?
				\item Write down a first-order approximation to $W^t$ \emph{with respect to time} at $t=0$.

					\emph{Hint: the hardest part of this question is figuring out what the previous sentence actually
					means. Don't get discouraged!}

%				\item Recall that for a matrix $X$,  $\det(X)$ is the signed volume of the parallelepiped determined by
%					the columns of $X$. Show that for all $X$, there exists $\varepsilon>0$ so that $\det(I+\varepsilon X) > 0$.
%					That is, all matrices ``close enough'' to $I$ have positive determinant.

				\item Using a first-order approximation for $W^t$, estimate the volume of the image of the unit cube
					after flowing for $\varepsilon$ seconds.

				\item Find the instantaneous rate of change of volume (area) with respect to time for $W^t$ at time $0$.

					Hint: Recall that $\det$ is a \emph{multi-linear} function of the columns of a matrix. 
					That is, linear relationships like $\det([\vec c_1|\vec c_2+\alpha \vec d|\vec c_3|\cdots])
					=\det([\vec c_1|\vec c_2|\vec c_3|\cdots])
					+\alpha\det([\vec c_1|\vec d|\vec c_3|\cdots])$ hold for every column.

				\item Show that if you drop a dab of ink of area $\alpha$ near the origin and let it flow for via $W^t$
					for $\varepsilon$ seconds,
					the area of the resulting blob of ink will be approximately $\alpha\varepsilon\Tr(A)$.
				\item Let $(N^t, \R^2)$ be a continuous dynamical system which flows points along the vector field
					$F:\R^2\to\R^2$ given by $F(x,y) = (f_x(x,y), f_y(x,y))$. 

					The first-order approximation to $F$ at a point $(x_0,y_0)$ is given by the \emph{Jacobian}
					of $F$ at that point. That is, if we define
					\[
						J(F)\big|_{(x_0,y_0)} = \mat{
							\frac{\partial f_x}{\partial x}(x_0,y_0) & \frac{\partial f_x}{\partial y}(x_0,y_0)\\[2pt]
							\frac{\partial f_y}{\partial x}(x_0,y_0) & \frac{\partial f_y}{\partial y}(x_0,y_0)
						},
					\]
					then 
					\[
						F\big((x_0,y_0) + \vec w\big) \approx J(F)\big|_{(x_0,y_0)}\vec w + F(x_0,y_0).
					\]

					A vector field is called \emph{incompressible} if $\nabla \cdot F = \frac{\partial f_x}{\partial x} + 
					\frac{\partial f_y}{\partial y}=0$ at all points in its domain (i.e., the divergence is zero everywhere).

					Is the term incompressible warranted? Explain using what you've learned from this problem.
			\end{enumerate}


	\end{enumerate}


	\subsection*{Programming Problems}
	For the programming problems, please use the Jupyter notebook available at

	\url{https://utoronto.syzygy.ca/jupyter/user-redirect/git-pull?repo=https://github.com/siefkenj/2020-MAT-335-webpage&subPath=homework/homework3-exercises.ipynb}

	Make sure to comment your code and use ``Markdown'' style cells to explain your answers.

	\begin{enumerate}
		\item We're going to make some beautiful simulations of continuous dynamical systems!

			The function \verb|plot_vectorfield| takes in a matplotlib \emph{axis} and a function from $\R^2$ to $\R^2$
			and plots the corresponding vector field. The functions {\tt V1}, {\tt V2}, {\tt V3}, and {\tt V4} from class
			have already been defined for you.

			Use \verb|plot_vectorfield| to create a plot that contains 4 subplots.\footnote{
				For a bonus, you could make a second plot using {\tt plot\_streams}.} Plot {\tt V1}, {\tt V2}, {\tt V3}, and {\tt V4}
			in these subplots. The extents should be the rectangle $[-2,2]^2$ and you should plot a $12\times 12$ grid of vectors
			(i.e., $N=12$).

			Using \verb|ax.set_title()|, label each of your subplots appropriately.
		\item The simplest way to simulate a flow along a vector field is called Euler's method.\footnote{If you want to play with more advanced
			methods, you can look up the \emph{Runge-Kutta-Fehlberg} methods. \url{http://web.cs.ucdavis.edu/~ma/ECS177/papers/particle_tracing.pdf}}
			Let $\vec F:\R^n\to\R^n$ be a vector field. Euler's method says to simulate a flow along $\vec F$ starting at $\vec v$
			perform a series of computations
			\begin{align*}
				\vec v_1 &= \vec v + \varepsilon \vec F(\vec v)\\
				\vec v_2 &= \vec v_1 + \varepsilon \vec F(\vec v_1)\\
				\vec v_3 &= \vec v_2 + \varepsilon \vec F(\vec v_2)\\
				&~\vdots\\
				\vec v_n &= \vec v_{n-1} + \varepsilon \vec F(\vec v_{n-1})
			\end{align*}
			Then, $\vec v_n$ will be the approximate result of flowing along $\vec F$ for $n\varepsilon$ seconds.

			Write a function {\tt euler} that takes in a starting $x$-coordinate, $y$-coordinate, a number of steps and an epsilon
			and performs Euler's method for {\tt V1} for the specified number of steps with the specified epsilon.
		\item Let's make some pictures! Along they way, we'll make a more general method.

			Create two functions {\tt flow} and {\tt orbit}. They each take in a starting $x$, $y$, a function
			that defines a vector field, a time, and an epsilon.

			{\tt flow} will use Euler's method with the specified parameters and output the result of flowing
			along the vector field for {\tt t} seconds (well, the approximate result).

			{\tt orbit} will perform the same operations as {\tt flow} except it will return a tuple \verb|(xs, ys)|
			where {\tt xs} and {\tt ys} are Numpy arrays with the $x$ and $y$ coordinates of every step of Euler's method.
			For example, if you did two steps of Euler's with $\vec v=(1,0)$, $\vec v_1=(1,0.01)$, and $\vec v_2=(0.99, 0.02)$,
			then {\tt orbit} would return {\tt xs=(1,1,0.99)} and {\tt ys=(0,0.01,0.02)}.

		\item For $V_1$, we know that all vectors flow in a circle with period $2\pi$ seconds. Let's see what our simulations
			tell us.

			Make a plot with the vector field $V_1$ and the $t=4\pi$ orbits\footnote{The orbit restricted to times between
			$0$ and $4\pi$.} of the point $(1,0)$ simulated with a steps size (epsilon) of $0.1$, $0.01$, and $0.001$. Are
			your simulated orbits periodic? Explain.

		\item We are going to try to guess the period of orbits from our simulations. The idea we'll use is as follows:
			We compute and see which points along the orbit are close to the starting point. We then use this information
			to compute the ``time'' that the orbit was closest to the starting point.

			We'll implement an algorithm to do this in steps.
			\begin{enumerate}
				\item A \emph{run} of integers is a sequence of integers $x_1,x_2,\ldots$
					where $x_i=x_{i-1}+1$. Create a function \verb|split_runs| which takes a list of integers and returns
					a list containing all maximal runs contained within the original sequence.
				\item Create a function \verb|indices_close_to_min| which inputs a 1D Numpy array and a tolerance and returns
					a list containing the indices of that array which are within the specified tolerance of the array's minimum
					value.
				\item Create a function \verb|guess_minimums| that inputs a Numpy array {\tt seq}, an epsilon, and a tolerance and
					outputs a guess of where the minimums of {\tt seq} are (in the form of a list); instead of returning the index
					of the minimum, your function should return epsilon$\times$index of minimums. 

					Some things to keep in mind:
					\begin{itemize}
						\item {\tt seq} may get close to the its minimum several times (and in our case, it will likely
							\emph{start} at its minimum).
						\item If {\tt seq} is close to its minimum at the \emph{run} of indices $(a,b,c)$,
							the minimum is probably closest to occurring at index $b$.
						\item If the input to your function came from an Euler approximation with step size epsilon,
							this function will output an estimate of what \emph{time} the minimums occur.
					\end{itemize}
				\item We know that the period of points flowing along $V_1$ is exactly $2\pi$ (excluding the origin).
					Use {\tt orbit} and \verb|guess_minimums| to estimate the period of flowing along
					$V_1$ starting at $\vec v_0=(-1,0)$. Estimate the period using step sizes of $0.01$ and $0.001$.
					How well do you approximate $2\pi$?
			\end{enumerate}
		\item Let's analyze the mysterious $V_3$.
			\begin{enumerate}
				\item Plot the vector field $V_3$ along with the orbits of $(-1,0)$, $(-1.1,0)$, and $(-1.2,0)$. Do you
					think flows starting at these points are periodic? Why or why not?
				\item Estimate the periods of the flows starting at $(-1,0)$, $(-1.1,0)$, and $(-1.2,0)$. Can you say with
					confidence whether or not the periods are the same?
					\label{REFPERIOD}
				\item Once and for all, argue whether or not flows along $V_3$ are stable.
			\end{enumerate}

		\item {\bf Flows of regions}. It's time to drop some ink in the current! We are going to flow polygonal regions along our vector
			fields.
			\begin{enumerate}
				\item Create the functions \verb|make_perimiter_circle| and \verb|make_perimiter_square|.
				\verb|make_perimiter_circle| inputs a center and radius and number of points and outputs points along
					the specified circle (in counter-clockwise order). \verb|make_perimiter_square| inputs a lower-left
					corner of a square, its width, and a number and outputs that many points along the edges of 
					the square (again in counter-clockwise order).

					Your functions should return a tuple {\tt (xs, ys)} with the coordinates.
				\item We can graph polygonal regions in Matplotlib using the {\tt Polygon} and {\tt PatchCollection}
					functions. But, they require as inputs a list of ordered pairs (whereas most other
					functions want the $x$s and $y$s as separate arrays). The \verb|zip_coords| utility function
					will take a tuple of $x$ coordinates and $y$ coordinates and turn it into a list
					of coordinate pairs.\footnote{This is a very similar operation to the transpose!}

					Read and execute the notebook cell that graphs a square and a circle.
				\item By using the trusty {\tt np.vectorize}, we can turn our {\tt flow} function into one
					that accepts lists of coordinates instead of single coordinates. Create \verb|vec_flow|,
					the vectorized version of {\tt flow}.

					Now, plot the vector field $V_3$ along with the square with lower-left corner $(-1,0)$ and
					width $1/2$ and the image of this square after it has flowed for $1.5$ seconds. (Use at least 100 points
					along the boundary of your square.)

					Make another plot and flow the square along $V_3$ for $\alpha$ seconds, where $\alpha$ is the period
					you got for $(-1,0)$ in \ref{REFPERIOD}.
				\item Execute the next cell which, if all works correctly, will render an animation of the unit cube flowing for 
					10 seconds. (If you want to save this animation as a movie, you can execute
					\verb|HTML(anim.to_html5_video())| and the right-click/ctrl-click to save the resulting movie.)

					\emph{Rendering the animation will take a while.}
				\item Produce an animation of the circle of radius $1/4$ centered at $(0,0)$ flowing for 20 seconds.
					Is the origin stable for this dynamical system?
			\end{enumerate}
		\item {\bf The Rings of Saturn}. According to Newtonian gravity, the speed of a body orbiting 
			at radius $r$ is inversely proportional to $\sqrt{r}$.
			\begin{enumerate}
				\item Assuming that the ``sun'' is at the origin, create a vector field {\tt V5} such that
					flows along that vector field behave like orbiting bodies.
				\item Produce an animation showing what would happen to a cloud of dust which started orbiting
					a planet.
				\item Why does Saturn have rings?
			\end{enumerate}
	\end{enumerate}



\end{document}
